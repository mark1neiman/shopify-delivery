<div
  class="pickup-card"
  id="pickup-root"
  data-default-country="{{ localization.country.iso_code }}"
  data-label-country="{{ 'pickup.labels.country' | t }}"
  data-label-provider="{{ 'pickup.labels.provider' | t }}"
  data-label-pickup-point="{{ 'pickup.labels.pickup_point' | t }}"
  data-text-loading="{{ 'pickup.text.loading' | t }}"
  data-text-select-pickup="{{ 'pickup.text.select_pickup' | t }}"
  data-text-pickup-not-required="{{ 'pickup.text.pickup_not_required' | t }}"
  data-text-no-providers="{{ 'pickup.text.no_providers' | t }}"
  data-text-no-points="{{ 'pickup.text.no_points' | t }}"
  data-text-selected="{{ 'pickup.text.selected' | t }}"
  data-text-price-label="{{ 'pickup.text.price_label' | t }}"
  data-text-search-placeholder="{{ 'pickup.text.search_placeholder' | t }}"
  data-text-fallback="{{ 'pickup.text.fallback_notice' | t }}"
  data-storefront-token="{{ block.settings.storefront_access_token }}"
  data-config-metaobject-type="{{ block.settings.config_metaobject_type }}"
  data-config-metaobject-handle="{{ block.settings.config_metaobject_handle }}"
  data-config-metaobject-field="{{ block.settings.config_metaobject_field }}"
  data-storefront-api-version="{{ block.settings.storefront_api_version }}"
>
  <div class="pickup-fallback" id="pickup-fallback" hidden></div>
  <div class="pickup-section">
    <div class="pickup-title">{{ 'pickup.labels.country' | t }}</div>
    <button class="pickup-select" id="pickup-country-btn" type="button">
      <span class="pickup-flag" id="pickup-country-flag"></span>
      <span id="pickup-country-label">{{ 'pickup.text.loading' | t }}</span>
      <span class="pickup-chevron">▾</span>
    </button>
    <div class="pickup-menu" id="pickup-country-menu" hidden></div>
  </div>

  <div class="pickup-section">
    <div class="pickup-title">{{ 'pickup.labels.provider' | t }}</div>

    <div id="pickup-providers" class="pickup-providers"></div>

    <div class="pickup-points" id="pickup-points">
      <div class="pickup-points-title">{{ 'pickup.labels.pickup_point' | t }}</div>
      <button class="pickup-select" id="pickup-point-btn" type="button">
        <span id="pickup-point-label">{{ 'pickup.text.select_pickup' | t }}</span>
        <span class="pickup-chevron">▾</span>
      </button>
      <div class="pickup-menu pickup-points-menu" id="pickup-point-menu" hidden>
        <div class="pickup-menu-search">
          <input
            id="pickup-search"
            class="pickup-input"
            type="text"
            placeholder="{{ 'pickup.text.search_placeholder' | t }}"
          />
        </div>
        <div id="pickup-point-list" class="pickup-point-list"></div>
      </div>
    </div>

    <div id="pickup-current" class="pickup-current"></div>

  </div>
</div>

<style>
  .pickup-card{
    border:1px solid rgba(0,0,0,.12);
    border-radius:18px;
    padding:16px;
    background:#fff;
    max-width:520px;
  }
  .pickup-fallback{
    margin-bottom:10px;
    border:1px solid rgba(251,191,36,.4);
    background:rgba(251,191,36,.16);
    color:#92400e;
    border-radius:12px;
    padding:10px 12px;
    font-size:13px;
    font-weight:600;
  }
  .pickup-section{
    padding:12px;
    background:#f3f4f6;
    border-radius:14px;
    margin-top:14px;
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  .pickup-title{font-weight:600;margin-bottom:2px}
  .pickup-radio{display:flex;gap:10px;align-items:center}
  .pickup-radio input{accent-color:#111}
  .pickup-delivery-options{
    display:flex;
    flex-direction:column;
    gap:6px;
    margin-left:26px;
    font-size:14px;
    color:#4b5563;
  }
  .pickup-delivery-options span{display:flex;justify-content:space-between}
  .pickup-select{
    width:100%;
    display:flex;
    align-items:center;
    gap:10px;
    padding:12px;
    border-radius:12px;
    border:1px solid rgba(0,0,0,.14);
    background:#fff;
    justify-content:space-between;
    cursor:pointer;
  }
  .pickup-flag{
    width:22px;height:14px;border-radius:3px;
    background:#ddd;display:inline-block;
    background-size:cover;
    background-position:center;
  }
  .pickup-chevron{opacity:.7}
  .pickup-menu{
    margin-top:8px;
    background:#fff;
    border:1px solid rgba(0,0,0,.12);
    border-radius:12px;
    overflow:hidden;
    box-shadow:0 10px 20px rgba(0,0,0,.08);
  }
  .pickup-menu button{
    width:100%;
    padding:10px 12px;
    display:flex;
    gap:10px;
    align-items:center;
    background:#fff;
    border:0;
    text-align:left;
    cursor:pointer;
  }
  .pickup-menu button:hover{background:#f3f4f6}
  .pickup-menu-search{
    padding:10px 12px;
    border-bottom:1px solid rgba(0,0,0,.08);
  }
  .pickup-providers{display:flex;flex-direction:column;gap:10px}
  .pickup-provider{
    display:flex;align-items:center;gap:10px;
    padding:10px 12px;
    border-radius:12px;
    border:1px solid rgba(0,0,0,.14);
    background:#fff;
    cursor:pointer;
  }
  .pickup-provider input{accent-color:#111}
  .pickup-provider img{width:84px;height:auto}
  .pickup-points{display:flex;flex-direction:column;gap:8px;position:relative}
  .pickup-points-title{font-weight:600;font-size:14px}
  .pickup-points-menu{
    max-height:280px;
    overflow:auto;
    position:absolute;
    left:0;
    right:0;
    top:100%;
    z-index:20;
  }
  .pickup-point-list{display:flex;flex-direction:column}
  .pickup-point-option{width:100%;border:0;background:#fff;text-align:left;padding:10px 12px;cursor:pointer}
  .pickup-point-option:hover{background:#f3f4f6}
  .pickup-input{
    width:100%;
    padding:12px;
    border-radius:12px;
    border:1px solid rgba(0,0,0,.14);
    background:#fff;
  }
  .pickup-current{
    margin-top:6px;
    opacity:.8;
    font-size:14px;
  }
  .pickup-summary{
    margin-top:12px;
    padding-top:10px;
    border-top:1px dashed rgba(0,0,0,.15);
    display:flex;
    flex-direction:column;
    gap:6px;
    font-size:14px;
  }
  .pickup-summary-row{
    display:flex;
    justify-content:space-between;
    gap:10px;
    color:#111827;
  }
  .pickup-summary-total{
    font-weight:600;
  }
</style>

<script src="{{ 'itella-pickup.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Pickup selector",
  "target": "section",
  "settings": [
    {
      "type": "text",
      "id": "storefront_access_token",
      "label": "Storefront access token",
      "info": "Required to read pickup config via Storefront API"
    },
    {
      "type": "text",
      "id": "config_metaobject_type",
      "label": "Config metaobject type",
      "default": "pickup_config"
    },
    {
      "type": "text",
      "id": "config_metaobject_handle",
      "label": "Config metaobject handle",
      "default": "default"
    },
    {
      "type": "text",
      "id": "config_metaobject_field",
      "label": "Config metaobject field key",
      "default": "config"
    },
    {
      "type": "text",
      "id": "storefront_api_version",
      "label": "Storefront API version",
      "default": "2024-10"
    }
  ]
}
{% endschema %}
